# Doubao API 客户端

这是一个基于 Node.js 的命令行工具，用于与 Doubao-Seed-1.6 API 进行对话交互，支持深度思考模式和流式输出功能。

## 功能特性

- 通过命令行与 Doubao API 进行实时对话
- 支持深度思考模式，提升回答质量
- 支持流式输出，改善用户体验
- 支持多轮对话，保持上下文连续性
- 支持环境变量配置 API 密钥，保障安全性
- 支持分块输出模式，突破API token限制，生成完整大文件
- 简洁的用户界面，易于使用

## 前提条件

- 安装 Node.js（推荐 v16.0.0 或更高版本）
- 拥有有效的 Doubao API 密钥

## 安装步骤

1. 克隆或下载此项目到本地

2. 安装依赖

   ```bash
   npm install
   ```

3. 配置 API 密钥
   - 复制`.env.example`文件并重命名为`.env`
   - 在`.env`文件中填入您的实际 API 密钥
   ```
   ARK_API_KEY=您的API密钥
   ```

## 使用方法

启动程序：

```bash
npm start
```

程序启动后，您可以直接在命令行中输入问题或指令，Doubao API 会给出相应的回复。

### 控制命令

程序支持以下控制命令：

- `exit` - 退出程序
- `stream on` - 开启流式输出
- `stream off` - 关闭流式输出
- `deep on` - 开启深度思考模式
- `deep off` - 关闭深度思考模式
- `chunked on` - 开启分块输出模式（用于生成大文件，突破token限制）
- `chunked off` - 关闭分块输出模式
- `clear` - 清除对话历史
- `status` - 显示当前配置状态

### 深度思考模式

深度思考模式（Deep Thinking）可以让模型进行更深入的思考和分析，特别适合复杂问题的解答。开启方式：

```
deep on
```

**注意**：深度思考模式的响应时间可能较长，建议设置较长的超时时间。

### 流式输出

流式输出可以让模型的回答内容实时显示，无需等待整个推理过程完成，大大改善用户体验。开启方式：

```
stream on
```

### 续写模式（Prefill Response）- 突破token限制

本工具实现了豆包API文档中推荐的续写模式（Prefill Response），通过这种方式可以有效突破API的最大token限制，生成完整的大型文件。

**实现原理：**
- 基于豆包API的续写模式，通过在messages列表中添加一个空的assistant角色消息来启用
- 系统会自动检查API响应中的`finish_reason`字段，如果值为`length`，表示内容因长度限制被截断
- 当检测到内容被截断时，系统会自动发送后续请求，继续生成剩余内容
- 整个过程对用户透明，您将看到完整的连续输出

**使用方法：**
1. 输入命令 `chunked on` 开启续写模式
2. 输入您的代码生成请求
3. 程序会自动检测内容长度限制并分多次生成，直到完成整个文件
4. 生成完成后，您将看到完整的输出内容
5. 完成后可使用 `chunked off` 关闭续写模式

**注意事项：**
- 续写模式会根据内容长度自动决定是否需要分块，生成大型代码文件时推荐使用
- 系统设置了最大循环次数（20次），防止意外的死循环
- 生成过程中会实时显示进度和状态信息
- 由于需要多次API调用，生成时间可能会比普通模式长

### 多轮对话

程序会自动记录对话历史，支持多轮对话功能。当对话轮次过多时，会自动保留最近的几轮对话以保持上下文。

如需清除对话历史，输入：

```
clear
```

## 项目结构

```
douabo/
├── index.js         # 主程序文件
├── package.json     # 项目依赖配置
├── .env             # 环境变量配置文件（需自行创建）
├── .env.example     # 环境变量示例文件
└── README.md        # 使用说明文档
```

## 注意事项

- 确保您的 API 密钥妥善保管，不要泄露给他人
- 如果遇到 API 调用错误，请检查您的网络连接和 API 密钥是否正确
- 深度思考模式下，建议使用流式输出来避免因超时导致的任务失败
- 程序默认超时时间设置为 30 分钟，以适应深度思考模式的较长处理时间
- 流式输出时，内容会实时显示，而不是等待整个回答生成完毕
